{% from "_macros/form.njk" import FormGroup, Fieldset, TextField, AddAnother, Link, MultipleChoiceField, PreviouslySelected, HiddenField, DateFieldset, Typeahead %}
{% from "_macros/form.njk" import EntitySearchForm, Form, MultiStepForm with context %}
{% from "_macros/common.njk" import LocalHeader with context %}
{% from "_macros/common.njk" import Message, MessageList, Breadcrumbs, Pagination, GlobalNav, LocalNav, Progress, FromNow, AnswersSummary, HiddenContent %}
{% from "_macros/collection.njk" import CollectionContent, CollectionFilters %}
{% from "_macros/entity.njk" import MetaList %}

{% if IS_XHR %}
  {% extends "./xhr.njk" %}
{% else %}
  {% extends "template.njk" %}
{% endif %}

{% set pageTitle = [getPageTitle() if getPageTitle, 'DIT Data Hub'] | removeNilAndEmpty | flatten | join(' - ') %}
{%- set titleDefault = 'Department for International Trade' -%}
{%- set htmlClasses = 'no-js' -%}

{% block pageTitle %}
  {{ pageTitle or titleDefault }}
{% endblock %}

{% block head %}
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="version" content="{{ APP_VERSION }}">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  {% if description -%}
    <meta name="description" content="{{ description }}">
  {% endif -%}

  {% if CANONICAL_URL %}
    <link rel="canonical" href="{{ CANONICAL_URL }}">
  {% endif %}

  <!--[if IE]><link rel="shortcut icon" href="{{ getAssetPath('images/favicon.ico') }}" type="image/x-icon"><![endif]-->
  <!-- Touch Icons - iOS and Android 2.1+ 180x180 pixels in size. -->
  <link rel="apple-touch-icon" href="{{ getAssetPath('images/apple-touch-icon.png')}}">
  <!-- Firefox, Chrome, Safari, IE 11+ and Opera. 192x192 pixels in size. -->
  <link rel="icon" href="{{ getAssetPath('images/favicon-192x192.png') }}" type="image/png">

  <!-- opengraph -->
  <meta property="og:url" content="{{ CANONICAL_URL }}">
  <meta property="og:site_name" content="{{ [siteTitle, serviceTitle] | removeNilAndEmpty | join(' ') }}">
  <meta property="og:title" content="{{ title | default(titleDefault) }}">
  {% if description  -%}
    <meta property="og:description" content="{{ description }}">
  {% endif -%}
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_GB">
  <meta property="og:image" content="{{ getAssetPath('images/opengraph-image.png') }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="1200">

  <!-- twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:domain" content="{{ BASE_URL }}">
  <meta name="twitter:title" content="{{ title | default(titleDefault) }}">
  {% if description  -%}
    <meta name="twitter:description" content="{{ description }}">
  {% endif -%}

  <!-- styles -->
  <link href="{{ getAssetPath('styles.css') }}" media="screen, print" rel="stylesheet">

  <!-- Google Tag Manager (GTM) -->
  {% include "_includes/google-tag-manager-snippet.njk" %}

  <script>
    (function(d){d.className=d.className.replace(/\bno-js\b/,'js-enabled')})(document.documentElement)
  </script>

  <!--[if lt IE 9]>
    <script src="{{ getAssetPath('html5shiv.min.js') }}"></script>
  <![endif]-->
{% endblock %}

{% block bodyStart %}
  {% include "_includes/google-tag-manager-no-script.njk" %}

  <div class="notification-banner u-js-hidden u-print-hide" id="global-cookies-banner" role="alert">
    <p class="notification-banner__inner">
      GOV.UK uses cookies to make the site simpler.
      <a href="https://www.gov.uk/help/cookies">Find out more about cookies</a>
    </p>
  </div>

{% endblock %}

{% block header %}
  <header class="global-header" aria-label="global header">
    <div class="global-header__inner">
      {% block header_site_title %}
        <div class="global-header__site-title">
          <a href="/" class="global-header__link">
            <span class="global-header__logo">
              <span class="global-header__site-name">{{ siteTitle|default(titleDefault) }}</span>
              {% if serviceTitle %}
                <span class="global-header__service-name">{{ serviceTitle }}</span>
              {% endif %}
            </span>
          </a>
          {% if not phaseBanner and projectPhase|lower in ['alpha', 'beta', 'demo'] %}
            <span class="phase-badge">{{ projectPhase.toUpperCase() }}</span>
          {% endif %}
        </div>
      {% endblock %}
      {% block header_menu %}
        <nav aria-label="global nav">
          <ul class="proposition-menu">
            {% if feedbackLink %}
              <li class="proposition-menu__item">
                <a href="{{ feedbackLink }}"
                   class="proposition-menu__link {{ 'is-active' if CURRENT_PATH and '/support' in CURRENT_PATH }}">Support</a>
              </li>
            {% endif %}
            {% if user %}
              <li class="proposition-menu__item">
                <a href="/profile" class="proposition-menu__link {{ 'is-active' if CURRENT_PATH == '/profile' }}">{{ user.name }}</a>
              </li>
            {% endif %}
            {% if user %}
              <li class="proposition-menu__item">
                  <a href="/oauth/sign-out" class="proposition-menu__link">Sign out</a>
              </li>
            {% endif %}
          </ul>
        </nav>
      {% endblock %}
    </div>
  </header>
  {{ GlobalNav({ items: GLOBAL_NAV_ITEMS }) if user }}
{% endblock %}

{% block main %}
  <main class="main-content" id="main-content">
    {% block body_main_header %}

      {% block body_main_phase_banner %}
        {% if phaseBanner and (projectPhase|lower in ['alpha', 'beta', 'demo'] or feedbackLink) %}
          <div class="phase-banner">
            <div class="l-container">
              <span class="phase-badge">{{ projectPhase.toUpperCase() }}</span>
              <span class="phase-banner__message">
                This is a new service
                {% if feedbackLink %}
                â€“ your <a href="{{ feedbackLink }}">feedback</a> will help us to improve it.
                {% endif %}
              </span>
            </div>
          </div>
        {% endif %}
      {% endblock %}

      {% block local_header %}
        {% set pageTitle = getPageTitle() if getPageTitle %}
        {% set heading = heading or pageTitle[0] %}
        {{ LocalHeader({ heading: heading, modifier: 'light-banner' }) }}
      {% endblock %}

    {% endblock %}

    <div class="main-content__inner l-container">
      {% block body_main_content %}{% endblock %}
    </div>

  </main>
{% endblock %}

{% block footer %}{% endblock %}

{% block bodyEnd %}
  <!--[if gt IE 8]><!-->
      <script src="{{ getAssetPath('app.js') }}"></script>
  <!--<![endif]-->
{% endblock %}
