{% extends "_layouts/two-column.njk" %}

{% from "_macros/entities.njk" import Entity with context %}

{% block main_grid_left_column %}
  {% include './_filters-form.njk' %}
{% endblock %}

{% block main_grid_right_column %}
  <article class="c-results">

    <header class="c-results__summary">
      <div class="u-clearfix">
        <div class="u-float-left">
          <span class="c-results__count">{{ results.count }}</span> projects
          {{ 'matching' if form.data.filters | length }}
        </div>
        {% if form.data.filters|length > 1 %}
          <a href="?custom=true" class="c-results__summary__filter-remove-all u-float-right js-xhr" aria-label="Reset filter results">
            Remove all filters
          </a>
        {% endif %}
      </div>
      {% if form.data.filters|length %}
        <div class="c-results__summary-filters">
          {% for name, value in form.data.filters %}
            {% set selectedFilter = findFilter(name, value) %}
            {% if selectedFilter|length %}
              <span class="c-results__summary-filter">
                <span class="c-results__summary-filter-type">{{ selectedFilter.label }}</span>
                <span class="c-results__summary-filter-name">
                  {%- if 'date' in name -%}
                    {{ selectedFilter.value | formatDate('MMMM DD, YYYY') }}
                  {%- else -%}
                    {{ selectedFilter.value }}
                  {%- endif -%}
                </span>
                <a
                  class="c-results__summary-filter-remove js-xhr"
                  href="{{ buildQuery({ include: { custom: true }, excludeKeys: [name] }) }}"
                  aria-label="Remove filter"
                >Ã—</a>
              </span>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </header>

    {% if results.items|length %}
      <div class="c-results__sort">
        {% if results.pagination %}
          <span class="c-results__page-summary">
            Page {{ results.pagination.currentPage }} of {{ results.pagination.totalPages }}
          </span>
        {% endif %}

        {% call Form({
          method: 'get',
          class: 'c-results__sort-form js-AutoSubmit',
          disableFormActions: true,
          hiddenFields: form.data.filters | assign({ custom: true })
        }) %}
          {{ MultipleChoiceField({
            name: 'sortby',
            label: 'Sort by',
            value: form.data.sorting.sortby,
            options: form.options.sortby,
            modifier: ['small', 'inline', 'light']
          }) }}
          <button class="button button-secondary u-js-hidden">Sort</button>
        {% endcall %}
      </div>
    {% endif %}

    <ol class="c-entity-list">
      {% for project in results.items %}
        <li class="c-entity-list__item">
          {{ Entity(project) }}
        </li>
      {% endfor %}
    </ol>

    {{ Pagination(results.pagination) }}
  </article>
{% endblock %}
