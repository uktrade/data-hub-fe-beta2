{% extends "_layouts/two-column.njk" %}


{% block main_grid_left_column %}{% endblock %}

{% block main_grid_right_column %}

  <h2 class="heading-medium">Client company</h2>

  <table class="table--key-value">
    <tbody>
      <tr>
        <td>{{ company.name }}</td>
      </tr>
      <tr>
        <td>{{ company.registered_address_country.name }}</td>
      </tr>
      <tr>
        <td>{{ companyInvestments.count|default('No', true) }} investment {{ 'project' | pluralise(companyInvestments.count) }} in the UK</td>
      </tr>
      {% if company.classification %}
        <tr>
          <td>{{ company.classification.name }}</td>
        </tr>
      {% endif %}
      {% if company.one_list_account_owner %}
        <tr>
          <td>
            Relationship manager: {{ company.one_list_account_owner.first_name }} {{ company.one_list_account_owner.last_name }}
          </td>
        </tr>
      {% endif %}
    </tbody>
  </table>

  {% if showSearch or searchTerm %}
    <h2 class="heading-medium">Find the source of foreign equity investment</h2>

    {{ EntitySearchForm({
      inputName: 'term',
      inputLabel: 'Search for company name',
      searchTerm: searchTerm
    }) }}

    {% if searchResult %}

      {% component 'results-summary', {
        resultType: 'company',
        pluralisedResultType: 'companies',
        total: searchResult.count,
        searchTerm: searchTerm
      } %}

      {% if searchResult.count > 0 %}
        <ol class="c-entity-list">
          {% for result in searchResult.results %}
            <li class="c-entity-list__item">
              <a href="/investment-projects/create/project/{{ result.id }}/{{ investmentType }}?client-company={{ company.id }}" class="c-entity-list__link">
                <h3 class="c-entity-list__item-header">{{ result.name | highlight(searchTerm) }}</h3>

                <dl class="metadata-list">
                  <dt class="metadata-list__term u-visually-hidden">Registered address</dt>
                  <dd class="metadata-list__value metadata-list__value--block">
                    {% set comma = joiner() %}
                    {% for part in [result.registered_address_1, result.registered_address_2, result.registered_address_town, result.registered_address_postcode] -%}
                      {% if part -%}
                        {%- set address = part -%}

                        {{ comma() }}
                        {% if loop.last -%}
                          {{ address | upper }}
                        {% else -%}
                          {{ address | capitalize }}
                        {%- endif %}
                      {%- endif %}
                    {%- endfor %}
                  </dd>
                  <dt class="metadata-list__term u-visually-hidden">Registered country</dt>
                  <dd class="metadata-list__value">{{ result.registered_address_country.name }}</dd>
                  {% if result.investments %}
                    <dt class="metadata-list__term u-visually-hidden">Investments in the UK</dt>
                    <dd class="metadata-list__value">{{ result.investments.count|default('No', true) }} investment project{{ 's' if result.investments.count != 1 }}</dd>
                  {% endif %}
                  {% if result.classification %}
                    <dt class="metadata-list__term u-visually-hidden">Classification</dt>
                    <dd class="metadata-list__value">{{ result.classification }}</dd>
                  {% endif %}
                  {% if result.one_list_account_owner %}
                    <dt class="metadata-list__term">Relationship manager</dt>
                    <dd class="metadata-list__value">{{ result.one_list_account_owner.first_name }} {{ result.one_list_account_owner.last_name }}</dd>
                  {% endif %}
                </dl>
              </a>
            </li>
          {% endfor %}
        </ol>
      {% endif %}

      {{ Pagination(searchResult.pagination) }}

      <p class="infostrip">If you can’t find the company you’re looking for, <a href="/companies/add-step-1">add a new company</a>. Unfortunately you will lose your progress.</p>
    {% endif %}

  {% elseif company %}

    {% call Form(form | assign({
      buttonText: 'Continue',
      hiddenFields: {
        company_id: company.id
      }
    })) %}
    {{ MultipleChoiceField({
        type: 'radio',
        name: 'is_equity_source',
        label: 'Will this company be the source of foreign equity investment?',
        modifier: 'inline',
        error: form.errors.messages.is_equity_source,
        options: [
          {
            value: 'true',
            label: 'Yes'
          }, {
            value: 'false',
            label: 'No'
          }
        ]
      })
    }}
    {% endcall %}

  {% endif %}

{% endblock %}
